<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒªãƒ–ã‚±ãƒ¼ã‚¸é€£å‹•ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ­ã‚°</title>

<!-- âœ… PWAè¨­å®š -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111111">

<!-- âœ… iOSãƒ›ãƒ¼ãƒ ç”»é¢ã‚¢ã‚¤ã‚³ãƒ³ -->
<link rel="apple-touch-icon" sizes="192x192" href="images/icon-192.png">
<link rel="apple-touch-icon" sizes="512x512" href="images/icon-512.png">

<!-- ğŸ’¡ iOS splashç”»é¢æŒ‡å®šï¼ˆæ‰‹å‹•ã§å¿…è¦ï¼‰ -->
<link rel="apple-touch-startup-image" href="images/splash-portrait.jpg"
      media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">

<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("âœ… Service Worker registered"))
      .catch(e => console.error("âŒ SW registration failed:", e));
  });
}
</script>
  
<style>
body {
  font-family: system-ui, sans-serif;
  background:#111;
  color:#eee;
  margin:0;
  padding:20px;
  line-height:1.7;
  overflow-x:hidden;
}

h1 {
  text-align:center;
  color:#ff0;
  font-size:1.4em;
  margin-bottom:10px;
}

/* ğŸŒŠé€²æ—ãƒãƒ¼ */
.progress-container {
  background:#333;
  border-radius:10px;
  overflow:hidden;
  height:20px;
  margin:15px 0 25px 0;
}
.progress-bar {
  height:100%;
  width:0%;
  text-align:center;
  font-size:0.8em;
  color:#fff;
  transition:width 0.5s ease-in-out;
  background: linear-gradient(90deg,#ff6600,#ffaa33,#ff6600);
  background-size:200% 100%;
  animation: wave 3s ease-in-out infinite;
  box-shadow:0 0 10px rgba(255,165,0,0.4);
}
@keyframes wave {
  0%{background-position:0 0;}
  50%{background-position:100% 0;}
  100%{background-position:0 0;}
}

/* âœ… ã‚»ã‚¯ã‚·ãƒ§ãƒ³é…ç½® */
section {
  background:#222;
  border-radius:8px;
  padding:12px 14px;
  margin-bottom:12px;
}

/* summaryï¼‹ãƒœã‚¿ãƒ³ã®æ¨ªä¸¦ã³ */
summary.summary-row {
  display:flex;
  justify-content:space-between;
  align-items:center;
  list-style:none;
  color:#ff0;
  font-weight:bold;
  font-size:clamp(0.85em, 3vw, 1.05em); /* â† ç”»é¢å¹…ã«å¿œã˜ã¦æ–‡å­—ã‚µã‚¤ã‚ºå¯å¤‰ */
  cursor:pointer;
  padding:6px 0;
  white-space:nowrap; /* æ”¹è¡Œç¦æ­¢ */
  overflow:hidden; /* ã¯ã¿å‡ºã—é˜²æ­¢ */
}

button.check {
  flex-shrink:0;
  margin-left:8px;
  font-size:clamp(0.8em, 2.8vw, 0.9em); /* ãƒœã‚¿ãƒ³æ–‡å­—ã‚‚å¯å¤‰ */
}

/* ã‚¹ãƒãƒ›ã§é–‹é–‰æ™‚ã«å¼·èª¿ */
details[open] summary {
  background:rgba(255,255,0,0.1);
  border-radius:4px;
}

/* ç”»åƒ */
img {
  width:100%;
  border-radius:8px;
  margin-top:8px;
}

.log { color:#0f0; font-size:0.9em; margin-top:8px; }
.last { color:#0ff; font-size:0.85em; margin-top:3px; }

#reset {
  display:block;
  width:100%;
  background:#900;
  color:#fff;
  font-size:1em;
  padding:10px;
  border:none;
  border-radius:6px;
  margin-top:25px;
  cursor:pointer;
}
footer {
  text-align:center;
  margin-top:25px;
  color:#888;
  font-size:0.85em;
}
</style>
</head>

<body>
<h1>ãƒªãƒ–ã‚±ãƒ¼ã‚¸é€£å‹•ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ­ã‚°</h1>

<div class="progress-container">
  <div class="progress-bar" id="progressBar">ä»Šé€± 0 / 3 å›</div>
</div>

<!-- ==== å„ãƒ‰ãƒªãƒ« ==== -->
<section>
  <details>
    <summary class="summary-row">
      <span>â‘  ãƒªãƒ–ã‚±ãƒ¼ã‚¸ãƒ»ãƒ‡ãƒƒãƒ‰ãƒã‚°</span>
      <button class="check" onclick="addLog(this)">â–¡ GO</button>
    </summary>
    <img src="images/deadbug-1.jpg" alt="ãƒªãƒ–ã‚±ãƒ¼ã‚¸ãƒ»ãƒ‡ãƒƒãƒ‰ãƒã‚°">
    <p><b>ç›®çš„ï¼š</b>éª¨ç›¤ã¨è‚‹éª¨ã®æ³¢å‹•é€£å‹•ã§å››è‚¢ã‚’åˆ¶å¾¡ã™ã‚‹ã€‚</p>
    <p class="log">ä»Šæœˆã®å®Ÿæ–½æ—¥ï¼š<span id="log1"></span></p>
    <p class="last">æœ€çµ‚å®Ÿæ–½æ—¥ï¼š<span id="last1">â€•</span></p>
  </details>
</section>

<section>
  <details>
    <summary class="summary-row">
      <span>â‘¡ ãƒªãƒ–ã‚±ãƒ¼ã‚¸ãƒ»ãƒã‚¦ãƒ³ã‚¹</span>
      <button class="check" onclick="addLog(this)">â–¡ GO</button>
    </summary>
    <img src="images/bounce-1.jpg" alt="ãƒªãƒ–ã‚±ãƒ¼ã‚¸ãƒ»ãƒã‚¦ãƒ³ã‚¹">
    <p><b>ç›®çš„ï¼š</b>è‚‹éª¨ã®åœ§ç¸®åå°„ã§ä¸Šä¸‹ã®ãƒãƒåå¿œã‚’é«˜ã‚ã‚‹ã€‚</p>
    <p class="log">ä»Šæœˆã®å®Ÿæ–½æ—¥ï¼š<span id="log2"></span></p>
    <p class="last">æœ€çµ‚å®Ÿæ–½æ—¥ï¼š<span id="last2">â€•</span></p>
  </details>
</section>

<section>
  <details>
    <summary class="summary-row">
      <span>â‘¢ ã‚¹ãƒ†ãƒƒãƒ—å°ãƒ’ãƒƒãƒ—ãƒ‰ãƒªãƒ•ãƒˆ</span>
      <button class="check" onclick="addLog(this)">â–¡ GO</button>
    </summary>
    <img src="images/hipdrift-1.jpg" alt="ã‚¹ãƒ†ãƒƒãƒ—å°ãƒ’ãƒƒãƒ—ãƒ‰ãƒªãƒ•ãƒˆ">
    <p><b>ç›®çš„ï¼š</b>éª¨ç›¤ã®æ»‘èµ°ã‚’æ»‘ã‚‰ã‹ã«ã—ã€é‡å¿ƒç§»å‹•ã‚’åˆ¶å¾¡ã€‚</p>
    <p class="log">ä»Šæœˆã®å®Ÿæ–½æ—¥ï¼š<span id="log3"></span></p>
    <p class="last">æœ€çµ‚å®Ÿæ–½æ—¥ï¼š<span id="last3">â€•</span></p>
  </details>
</section>

<section>
  <details>
    <summary class="summary-row">
      <span>â‘£ ãƒªãƒ–ã‚±ãƒ¼ã‚¸ãƒ»ãƒ—ãƒ¬ã‚¹</span>
      <button class="check" onclick="addLog(this)">â–¡ GO</button>
    </summary>
    <img src="images/press-1.jpg" alt="ãƒªãƒ–ã‚±ãƒ¼ã‚¸ãƒ»ãƒ—ãƒ¬ã‚¹">
    <p><b>ç›®çš„ï¼š</b>è‚‹éª¨åœ§ç¸®ã«ã‚ˆã‚‹ä½“å¹¹ã‹ã‚‰ã®åŠ›ä¼é”ã‚’å­¦ã¶ã€‚</p>
    <p class="log">ä»Šæœˆã®å®Ÿæ–½æ—¥ï¼š<span id="log4"></span></p>
    <p class="last">æœ€çµ‚å®Ÿæ–½æ—¥ï¼š<span id="last4">â€•</span></p>
  </details>
</section>

<section>
  <details>
    <summary class="summary-row">
      <span>â‘¤ MBãƒªãƒ–ã‚±ãƒ¼ã‚¸ãƒ»ãƒªãƒ¼ãƒ‰ãƒ»ãƒ‰ãƒªãƒ«</span>
      <button class="check" onclick="addLog(this)">â–¡ GO</button>
    </summary>
    <img src="images/mblead-1.jpg" alt="MBãƒªãƒ–ã‚±ãƒ¼ã‚¸ãƒ»ãƒªãƒ¼ãƒ‰ãƒ»ãƒ‰ãƒªãƒ«">
    <p><b>ç›®çš„ï¼š</b>è‚‹éª¨ä¸»å°ã§æ³¢ã®ã‚ˆã†ãªå‡ºåŠ›ä¼é”ã‚’ä½“å¾—ã™ã‚‹ã€‚</p>
    <p class="log">ä»Šæœˆã®å®Ÿæ–½æ—¥ï¼š<span id="log5"></span></p>
    <p class="last">æœ€çµ‚å®Ÿæ–½æ—¥ï¼š<span id="last5">â€•</span></p>
  </details>
</section>

<section>
  <details>
    <summary class="summary-row">
      <span>â‘¥ WBãƒªãƒ–ã‚±ãƒ¼ã‚¸ãƒ»ãƒªãƒ¼ãƒ‰ãƒ»ãƒ‰ãƒªãƒ«</span>
      <button class="check" onclick="addLog(this)">â–¡ GO</button>
    </summary>
    <img src="images/wblead-1.jpg" alt="WBãƒªãƒ–ã‚±ãƒ¼ã‚¸ãƒ»ãƒªãƒ¼ãƒ‰ãƒ»ãƒ‰ãƒªãƒ«">
    <p><b>ç›®çš„ï¼š</b>ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒƒã‚°ã®æµä½“æŠµæŠ—ã¨èº«ä½“æ³¢å‹•ã‚’åŒæœŸã€‚</p>
    <p class="log">ä»Šæœˆã®å®Ÿæ–½æ—¥ï¼š<span id="log6"></span></p>
    <p class="last">æœ€çµ‚å®Ÿæ–½æ—¥ï¼š<span id="last6">â€•</span></p>
  </details>
</section>

<section>
  <details>
    <summary class="summary-row">
      <span>â‘¦ BIG3ï¼ˆSQï¼DLï¼BPï¼‰</span>
      <button class="check" onclick="addLog(this)">â–¡ GO</button>
    </summary>
    <ul style="margin-top:6px; color:#ccc; font-size:0.9em; line-height:1.6;">
      <li>ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆï¼šä½“å¹¹ã®å›ºå®šã¨ä¸‹è‚¢å‡ºåŠ›ã®å”èª¿</li>
      <li>ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆï¼šéª¨ç›¤æ»‘èµ°ã¨èƒŒéƒ¨ä¼é”ã®çµ±åˆ</li>
      <li>ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹ï¼šèƒ¸éƒ­åœ§ç¸®ã¨æŠ¼ã—å‡ºã—é€£å‹•ã®å¼·åŒ–</li>
    </ul>
    <p class="log">ä»Šæœˆã®å®Ÿæ–½æ—¥ï¼š<span id="log7"></span></p>
    <p class="last">æœ€çµ‚å®Ÿæ–½æ—¥ï¼š<span id="last7">â€•</span></p>
  </details>
</section>
<!-- ğŸ”„ æ‰‹å‹•ãƒªã‚»ãƒƒãƒˆ -->
<button id="reset" onclick="resetAll()">ğŸ”„ å…¨ãƒªã‚»ãƒƒãƒˆ</button>

<!-- ğŸ“… å¹´é–“ãƒ­ã‚° -->
<h2 style="color:#ff0; margin-top:40px;">å¹´é–“ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ­ã‚°</h2>
<div id="yearlyLog" style="display:grid; grid-template-columns:repeat(13,1fr); gap:4px; margin-top:10px;"></div>
<p id="yearRate" style="color:#0ff; margin-top:10px; text-align:center;"></p>

<footer>Â©2025 adjustment-labï½œãƒªãƒ–ã‚±ãƒ¼ã‚¸é€£å‹•ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ­ã‚°</footer>

<script>
// ===== å®šæ•° =====
const drills = 7;
const monthKey = new Date().getFullYear() + "-" + ("0"+(new Date().getMonth()+1)).slice(-2);
const weekKey = getWeekKey();

// ===== åˆæœŸãƒ­ãƒ¼ãƒ‰ =====
window.onload = () => {
  cleanOldMonths();
  cleanOldWeeks();

  const today = getTodayStr();
  const lastOpenDate = localStorage.getItem("lastOpenDate");

  // ğŸŒ™ æ—¥ä»˜ãŒå¤‰ã‚ã£ãŸã‚‰ä»Šæ—¥ä»¥å¤–ã®ã€Œâœ”å®Œäº†ã€ã‚’ãƒªã‚»ãƒƒãƒˆ
  if (lastOpenDate && lastOpenDate !== today) {
    resetDailyButtons();
  }

  // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ä¿å­˜ï¼ˆæ¬¡å›æ¯”è¼ƒç”¨ï¼‰
  localStorage.setItem("lastOpenDate", today);

  // ğŸŒ™ ãƒœã‚¿ãƒ³ãƒ»ãƒ­ã‚°å¾©å…ƒ
  for (let i = 1; i <= drills; i++) {
    const logData = JSON.parse(localStorage.getItem(`log${i}_${monthKey}`)) || [];
    const lastDate = localStorage.getItem(`last${i}_${monthKey}`) || "â€•";
    document.getElementById(`log${i}`).textContent = logData.join("ãƒ»");
    document.getElementById(`last${i}`).textContent = lastDate;

    const btn = document.querySelectorAll(".check")[i - 1];
    if (logData.includes(today)) {
      btn.textContent = "âœ” å®Œäº†";
      btn.classList.add("done");
    } else {
      btn.textContent = "â–¡ GO";
      btn.classList.remove("done");
    }
  }

  updateProgressBar();
  updateYearlyLog();

  // ğŸŒ 5åˆ†ã”ã¨ã«æ—¥ä»˜å¤‰åŒ–ã‚’ç›£è¦–
  setInterval(() => {
    const now = getTodayStr();
    const stored = localStorage.getItem("lastOpenDate");
    if (stored !== now) {
      resetDailyButtons();
      localStorage.setItem("lastOpenDate", now);
      updateProgressBar();
    }
  }, 300000); // 5åˆ†ã”ã¨ãƒã‚§ãƒƒã‚¯
};

// ===== å®Ÿæ–½ãƒœã‚¿ãƒ³ =====
function addLog(btn){
  const section = btn.closest("section");
  const id = Array.from(document.querySelectorAll("section")).indexOf(section) + 1;
  const today = getTodayStr();
  let logData = JSON.parse(localStorage.getItem(`log${id}_${monthKey}`)) || [];

  if(!logData.includes(today)){
    // ğŸŒŸ æ–°è¦å®Ÿæ–½
    logData.push(today);
    localStorage.setItem(`log${id}_${monthKey}`, JSON.stringify(logData));
    localStorage.setItem(`last${id}_${monthKey}`, today);
    document.getElementById(`log${id}`).textContent = logData.join("ãƒ»");
    document.getElementById(`last${id}`).textContent = today;
    btn.textContent = "âœ” å®Œäº†";
    btn.classList.add("done");

    // ğŸŒŸ é€±ã‚«ã‚¦ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆï¼ˆ1æ—¥1å›ã ã‘ï¼‰
    const todayKey = `done_${today}`;
    if(!localStorage.getItem(todayKey)){
      localStorage.setItem(todayKey, "true");
      let weekCount = parseInt(localStorage.getItem(`weekCount_${weekKey}`) || "0");
      weekCount++;
      localStorage.setItem(`weekCount_${weekKey}`, weekCount);
      updateProgressBar();
    }

  } else {
    // ğŸŒ™ å‰Šé™¤å‡¦ç†
    if(confirm("ã“ã®æ—¥ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
      logData = logData.filter(x=>x!==today);
      localStorage.setItem(`log${id}_${monthKey}`, JSON.stringify(logData));
      const newLast = logData.length ? logData[logData.length-1] : "â€•";
      localStorage.setItem(`last${id}_${monthKey}`, newLast);
      document.getElementById(`log${id}`).textContent = logData.join("ãƒ»");
      document.getElementById(`last${id}`).textContent = newLast;
      btn.textContent = "â–¡ GO";
      btn.classList.remove("done");
    }
  }
}

// ===== æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ =====
function getTodayStr(){
  const d = new Date();
  return ("0"+(d.getMonth()+1)).slice(-2)+"/"+("0"+d.getDate()).slice(-2);
}

// ===== é€²æ—ãƒãƒ¼æ›´æ–°ï¼ˆé€±3å›MAXãƒ»2å›ã§é”æˆï¼‰ =====
function updateProgressBar(){
  let weekCount = parseInt(localStorage.getItem(`weekCount_${weekKey}`) || "0");
  if(weekCount < 0) weekCount = 0;
  if(weekCount > 3) weekCount = 3;

  const bar = document.getElementById("progressBar");
  const percent = Math.min((weekCount/3)*100, 100);
  bar.style.width = percent + "%";
  bar.textContent = `ä»Šé€± ${Math.min(weekCount,3)} / 3 å›`;

  if(weekCount >= 2){
    bar.style.background = "linear-gradient(90deg,#00ff55,#33ff99,#00ff55)";
    bar.style.boxShadow = "0 0 20px rgba(0,255,100,0.6)";
  } else {
    bar.style.background = "linear-gradient(90deg,#ff6600,#ffaa33,#ff6600)";
    bar.style.boxShadow = "0 0 10px rgba(255,165,0,0.4)";
  }

  if(weekCount >= 2 && !localStorage.getItem(`achieved_${weekKey}`)){
    localStorage.setItem(`achieved_${weekKey}`,"true");
    updateYearlyLog();
  }
}

// ===== å¹´é–“ãƒ­ã‚° =====
function updateYearlyLog(){
  const year = new Date().getFullYear();
  const container = document.getElementById("yearlyLog");
  container.innerHTML = "";
  let achievedWeeks = 0;

  for(let w=1; w<=52; w++){
    const weekId = `${year}-W${w}`;
    const box = document.createElement("div");
    box.style.width="100%";
    box.style.aspectRatio="1/1";
    box.style.borderRadius="3px";
    box.style.display="flex";
    box.style.alignItems="center";
    box.style.justifyContent="center";
    box.style.fontSize="0.7em";
    box.textContent = w.toString().padStart(2,"0");
    box.style.border="1px solid #333";
    box.style.color="#bbb";
    box.style.opacity=0.6;

    if(localStorage.getItem(`achieved_${weekId}`)){
      box.style.border="2px solid #0f0";
      box.style.color="#fff";
      box.style.opacity=1;
      achievedWeeks++;
    }
    container.appendChild(box);
  }

  const rate = ((achievedWeeks/52)*100).toFixed(1);
  document.getElementById("yearRate").textContent = 
    `å¹´é–“é”æˆç‡ï¼š${rate}%ï¼ˆ${achievedWeeks}/52é€±ï¼‰`;
}

// ===== é€±ã‚­ãƒ¼ç”Ÿæˆ =====
function getWeekKey(){
  const today = new Date();
  const onejan = new Date(today.getFullYear(),0,1);
  const week = Math.ceil((((today - onejan) / 86400000) + onejan.getDay()+1) / 7);
  return `${today.getFullYear()}-W${week}`;
}

// ===== å¤ã„ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ =====
function cleanOldMonths(){
  const nowMonth = monthKey;
  Object.keys(localStorage).forEach(k=>{
    if((k.startsWith("log") || k.startsWith("last")) && !k.includes(nowMonth)){
      localStorage.removeItem(k);
    }
  });
}
function cleanOldWeeks(){
  const nowWeek = weekKey;
  Object.keys(localStorage).forEach(k=>{
    if(k.startsWith("weekCount") && !k.includes(nowWeek)){
      localStorage.removeItem(k);
    }
    if(k.startsWith("achieved") && !k.includes(nowWeek)){
      localStorage.removeItem(k);
    }
  });
}

// ===== å…¨ãƒªã‚»ãƒƒãƒˆ =====
function resetAll(){
  if(confirm("å…¨ã¦ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
    localStorage.clear();
    for(let i=1; i<=drills; i++){
      document.getElementById(`log${i}`).textContent = "";
      document.getElementById(`last${i}`).textContent = "â€•";
      const btn = document.querySelectorAll(".check")[i-1];
      btn.textContent = "â–¡ GO";
      btn.classList.remove("done");
    }
    updateProgressBar();
    updateYearlyLog();
  }
}
</script>

<!-- âœ… ã‚¹ãƒãƒ›ãƒ»iPadå¯¾å¿œ summary é–‹é–‰ -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll("summary").forEach(summary => {
    summary.addEventListener("click", e => {
      const details = summary.parentNode;
      if(details.open){
        details.removeAttribute("open");
      } else {
        details.setAttribute("open", "true");
      }
    });
  });
});
</script>

</body>
</html>
